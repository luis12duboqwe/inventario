flowchart TD
    subgraph POS "Flujo POS"
        POSCart[Carrito POS]
        POSPayment[Pago y descuentos]
        POSReceipt[Recibo PDF]
        POSCart --> POSPayment --> POSReceipt
    end

    subgraph Repairs "Reparaciones"
        Intake[Recepción y diagnóstico]
        Parts[Descuento de refacciones]
        Ready[Entrega y PDF]
        Intake --> Parts --> Ready
    end

    subgraph Sync "Sincronización híbrida"
        Outbox[Evento en sync_outbox]
        Retry[Reintento /sync/outbox/retry]
        Metrics[Métricas de outbox]
        Outbox --> Retry --> Metrics
    end

    POSReceipt -->|Genera venta| Outbox
    Ready -->|Actualiza estado| Outbox
    Customers[Clientes corporativos] -->|Actualización| Outbox
    Outbox -.->|Prioridad HIGH/NORMAL/LOW| Retry
    Retry -.->|Último intento exitoso| Metrics
